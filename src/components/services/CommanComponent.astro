---
import Layout from "../../layouts/Layout.astro";
import Contact from "../common/Contact.astro";
import ServiceVideo from "../../layouts/ServiceVideo.astro";
import DifferentiatorCards from "./DifferentiatorCards.astro";
import ApproachSection from "./ApproachSection.astro";
import ExpertiseGrid from "./ExpertiseGrid.astro";
import CapabilitiesAccordion from "./CapabilitiesAccordion.astro";
import "../../styles/service.css";

const { frontmatter } = Astro.props;

// Hero highlight logic
const getHighlightedText = (text: string, phrases: string[]) => {
  for (const phrase of phrases) {
    if (text.includes(phrase)) return phrase;
  }
  return null;
};

const heroHighlight = getHighlightedText(frontmatter.hero_title || "", [
  "Data Engineering",
  "Data engineering",
  "Data Science",
  "Data science",
  "Data Strategy",
]);

const heroHighlightColor =
  heroHighlight &&
  (heroHighlight.includes("Data") ||
    heroHighlight.includes("Data Strategy") ||
    heroHighlight.includes("Data Engineering"))
    ? "#ffffff"
    : "#EEBF2E";

const heroParts = heroHighlight
  ? (frontmatter.hero_title || "").split(heroHighlight)
  : null;

// Differentiator highlight logic
const diffHighlight = getHighlightedText(frontmatter.differentiators_heading || "", [
  "Why Partner with Us",
  "Data Science",
  "Data science",
  "Data Strategy Consulting",
]);

const diffHighlightColor =
  frontmatter.hero_title?.includes("Data Science") ||
  frontmatter.hero_title?.includes("Data science")
    ? "#ffffff"
    : "#ffff";

const diffParts = diffHighlight
  ? (frontmatter.differentiators_heading || "").split(diffHighlight)
  : null;

// Approach highlight logic
const approachHighlight = getHighlightedText(
  frontmatter.approach_heading || "",
  ["Implementation Workflow", "Implementation workflow", "Implementation Process"]
);

const approachParts = approachHighlight
  ? (frontmatter.approach_heading || "").split(approachHighlight)
  : null;
---

<Layout
  title={frontmatter.seo_title || frontmatter.hero_title}
  description={frontmatter.seo_description || (frontmatter.p1_text + " " + (frontmatter.p2_text || ""))}
  keywords={frontmatter.seo_keywords || ""}
  canonical={Astro.url.pathname}
>
  <main class="page-wrapper background-style" style="height: max-content;" data-pagefind-ignore>
    <!-- Hero Section -->
    <ServiceVideo src={frontmatter.hero_video}>
      <div class="hero-text container">
        <div style="width:full; max-width:1296px; margin:0 auto 0 auto;">
          <h1 class="text-lg-start text-light fw-light fw-bold hero-heading">
            {
              heroParts ? (
                <>
                  {heroParts[0]}
                  <span style={`color: ${heroHighlightColor}`}>
                    {heroHighlight}
                  </span>
                  {heroParts.slice(1).join(heroHighlight)}
                </>
              ) : (
                frontmatter.hero_title
              )
            }
          </h1>
          <p class="fs-lg text-lg-start pb-3 pb-sm-0 pb-md-2 mb-4 mb-sm-5 hero-text1">
            {frontmatter.hero_text}
          </p>
          {
            frontmatter.hero_cta_text && (
              <div>
                <a
                  class="btn btn-primary rounded-pill hero-cta-btn"
                  href={frontmatter.hero_cta_link || "/contact-us"}
                >
                  {frontmatter.hero_cta_text}
                  <i class="ai-arrow-right ms-2 me-n1" />
                </a>
              </div>
            )
          }
        </div>
      </div>
    </ServiceVideo>

    <!-- Intro Section -->
    <section
      style="display: flex; justify-content: center; margin-top:5rem; margin-bottom:5rem;"
      class="container"
    >
      <div style="max-width:1296px;">
        <p style="font-size: 1.35rem; color:white">
          {frontmatter.p1_text}
        </p>
        <p style="font-size: 1.35rem; color:white; font-style:italic">
          {frontmatter.p2_text}
        </p>
      </div>
    </section>

    <!-- Differentiator Cards -->
    <DifferentiatorCards
      heading={frontmatter.differentiators_heading}
      highlightPhrase={diffHighlight}
      highlightColor={diffHighlightColor}
      parts={diffParts}
      cards={[
        {
          img: frontmatter.card1_img,
          heading: frontmatter.card1_heading,
          text: frontmatter.card1_text,
        },
        {
          img: frontmatter.card2_img,
          heading: frontmatter.card2_heading,
          text: frontmatter.card2_text,
        },
        {
          img: frontmatter.card3_img,
          heading: frontmatter.card3_heading,
          text: frontmatter.card3_text,
        },
      ]}
    />

    <slot />

    <!-- Approach Section -->
    <ApproachSection
      heading={frontmatter.approach_heading}
      highlightPhrase={approachHighlight}
      parts={approachParts}
      steps={[
        {
          img: frontmatter.approach1_img,
          heading: frontmatter.approach1_heading,
          text: frontmatter.approach1_text,
        },
        {
          img: frontmatter.approach2_img,
          heading: frontmatter.approach2_heading,
          text: frontmatter.approach2_text,
        },
        {
          img: frontmatter.approach3_img,
          heading: frontmatter.approach3_heading,
          text: frontmatter.approach3_text,
        },
        {
          img: frontmatter.approach4_img,
          heading: frontmatter.approach4_heading,
          text: frontmatter.approach4_text,
        },
      ]}
    />

    <!-- Expertise Grid -->
    <ExpertiseGrid
      items={[
        {
          img: frontmatter.expertise1_img,
          heading: frontmatter.expertise1_heading,
        },
        {
          img: frontmatter.expertise2_img,
          heading: frontmatter.expertise2_heading,
        },
        {
          img: frontmatter.expertise3_img,
          heading: frontmatter.expertise3_heading,
        },
        {
          img: frontmatter.expertise4_img,
          heading: frontmatter.expertise4_heading,
        },
        {
          img: frontmatter.expertise5_img,
          heading: frontmatter.expertise5_heading,
        },
        {
          img: frontmatter.expertise6_img,
          heading: frontmatter.expertise6_heading,
        },
      ]}
    />

    <!-- Capabilities Accordion -->
    <CapabilitiesAccordion
      capabilities={[
        {
          heading: frontmatter.capability1_heading || "Strategic Alignment",
          text:
            frontmatter.capability1_text ||
            "Platform-agnostic guidance focused on aligning technology choices (Snowflake, Databricks, BigQuery) with core business strategy, not vendor preference.",
        },
        {
          heading:
            frontmatter.capability2_heading || "Architecture Modeling",
          text:
            frontmatter.capability2_text ||
            "Utilizing industry-standard frameworks to model current and future-state Data Architecture (e.g., TOGAF, DAMA principles).",
        },
        {
          heading:
            frontmatter.capability3_heading || "Tool Selection & Evaluation",
          text:
            frontmatter.capability3_text ||
            "Providing unbiased advice on selecting the right tools for Data Governance, MDM, Data Catalogs, and ETL/ELT based on scale and budget.",
        },
        {
          heading: "Model Explainability (XAI)",
          text:
            frontmatter.responsible_ai_text ||
            "Embedding Responsible AI principles into the initial data collection and management phase to proactively mitigate bias and ensure fairness.",
        },
        {
          heading: "Bias and Fairness Audits",
          text:
            frontmatter.governance_integration_text ||
            "Defining the organizational structure and tools necessary to enforce Data Governance policies across all analytics and AI systems.",
        },
        {
          heading: "AI Governance Framework",
          text:
            frontmatter.regulatory_compliance_text ||
            "Strategically planning data access, security, and lineage to ensure proactive compliance with all relevant global and regional data protection laws (GDPR, CCPA).",
        },
      ]}
    />

    <Contact />
  </main>
</Layout>
