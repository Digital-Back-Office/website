---
import "flatpickr/dist/flatpickr.min.css";
import "flatpickr/dist/themes/dark.css";
---

<script>
    import flatpickr from "flatpickr";
    flatpickr(".date-picker", {
        enableTime: true,
        altInput: true,
        altFormat: "F j, Y H:i",
        dateFormat: "Y-m-d H:i",
        onOpen: function (selectedDates, dateStr, instance) {
            const calendarContainer = instance.calendarContainer;
            const monthElement = calendarContainer.querySelector(".flatpickr-month") as HTMLElement;
            const monthDropDown = calendarContainer.querySelector(".flatpickr-monthDropdown-months") as HTMLElement;
            const DropDownMonth = calendarContainer.querySelectorAll(".flatpickr-monthDropdown-month") as NodeListOf<HTMLElement>;
            const weekdays = calendarContainer.querySelectorAll(".flatpickr-weekday") as NodeListOf<HTMLElement>;
            const currMonth = calendarContainer.querySelector('.flatpickr-current-month') as HTMLElement;


            if (monthElement && monthDropDown && weekdays && DropDownMonth) {
                monthElement.style.backgroundColor = "#121519";
                monthDropDown.style.backgroundColor = "#121519";
                currMonth.style.display = 'flex';
                currMonth.style.justifyContent = 'space-between';
                weekdays.forEach((weekday) => {
                    weekday.style.backgroundColor = "#121519";
                });
                DropDownMonth.forEach((month) => {
                    month.style.backgroundColor = "#121519";
                });
            }
        },
    });
</script>

<script src="https://apis.google.com/js/api.js" is:inline></script>
<script src="https://accounts.google.com/gsi/client" is:inline></script>

<script>
    import Calendar from "../../utils/api/event-calendar.js";
    import dateTimeForCalander from "../../utils/helper/date-time.js";
    import event from "../../utils/helper/event.js";

    const BookBtn = document.querySelector(".book-btn");
    BookBtn?.addEventListener("click", async (e) => {
        e.preventDefault();
        // do validation checks
        const nameInput = document.querySelector("#name") as HTMLInputElement;
        const emailInput = document.querySelector("#email") as HTMLInputElement;
        const companyInput = document.querySelector("#company") as HTMLInputElement;
        const dateTimeInput = document.querySelector("#date-time-picker") as HTMLInputElement;

        const name = nameInput.value;
        const email = emailInput.value;
        const company = companyInput.value;
        const dateTime = dateTimeInput.value;

        if (name && email && company && dateTime) {
            const start = dateTimeForCalander(dateTime);
            const eventCreate = event(name, company, email, start);
            const calendar = new Calendar(eventCreate);
            await calendar.gapiLoaded();
            calendar.gisLoaded();
            calendar.handleAuthClick();
            // await calendar.createEvent();
        }
    });
</script>

<form class="card-body">
    <h2 class="h3 card-title text-white text-center pb-2 pb-xxl-3">
        30 mins FREE Consultation
    </h2>
    <div class="mb-1">
        <label class="form-label fs-base" for="name"> Your Name</label>
        <input
            class="form-control form-control-sm"
            type="text"
            placeholder="Enter your name"
            name="Name"
            required
            id="name"
        />
    </div>
    <div class="mb-1">
        <label class="form-label fs-base" for="company"> Company Name</label>
        <input
            class="form-control form-control-sm"
            type="text"
            placeholder="Enter your company's name"
            name="Company-name"
            required
            id="company"
        />
    </div>
    <div class="mb-1">
        <label class="form-label fs-base" for="email"> Email address</label>
        <input
            class="form-control form-control-sm"
            type="email"
            placeholder="Enter your email address"
            name="Email"
            required
            id="email"
        />
    </div>
    <div class="mb-1">
        <label class="form-label" for="date-time-picker">Date and time</label>
        <div class="position-relative">
            <input
                class="form-control form-control-sm date-picker pe-5"
                type="text"
                placeholder="Choose available date & time"
                name="Date-time"
                required
                id="date-time-picker"
            />
            <i
                class="ai-calendar position-absolute top-50 end-0 translate-middle-y fs-lg text-white opacity-80 me-3"
            ></i>
        </div>
    </div>
    <div
        class="d-flex flex-column flex-sm-row flex-lg-column flex-xxl-row align-items-center justify-content-center justify-content-lg-start pt-3 pt-xxl-4"
    >
        <button class="btn btn-outline-primary text-white book-btn w-100" type="submit">Book now</button>
    </div>
</form>
